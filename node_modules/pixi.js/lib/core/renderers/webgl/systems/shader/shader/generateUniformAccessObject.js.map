{"version":3,"sources":["../../../../../../../src/core/renderers/webgl/systems/shader/shader/generateUniformAccessObject.js"],"names":["generateUniformAccessObject","getterTemplate","join","setterTemplate","GLSL_TO_SINGLE_SETTERS","float","vec2","vec3","vec4","int","ivec2","ivec3","ivec4","bool","bvec2","bvec3","bvec4","mat2","mat3","mat4","sampler2D","samplerCube","GLSL_TO_ARRAY_SETTERS","gl","uniformData","uniforms","data","uniformKeys","Object","keys","i","length","fullName","nameTokens","split","name","uniformGroup","getUniformGroup","uniform","defineProperty","get","generateGetter","set","generateSetter","template","replace","Function","setTemplate","size","type","cur","o"],"mappings":"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","file":"generateUniformAccessObject.js","sourcesContent":["const getterTemplate = [\n    'return this.data.%%.value;',\n].join('\\n');\n\nconst setterTemplate = [\n    'this.data.%%.value = value;',\n    'var location = this.data.%%.location;',\n].join('\\n');\n\nconst GLSL_TO_SINGLE_SETTERS = {\n\n    float:    'uniform1f(location, value)',\n\n    vec2:     'uniform2f(location, value[0], value[1])',\n    vec3:     'uniform3f(location, value[0], value[1], value[2])',\n    vec4:     'uniform4f(location, value[0], value[1], value[2], value[3])',\n\n    int:      'uniform1i(location, value)',\n    ivec2:    'uniform2i(location, value[0], value[1])',\n    ivec3:    'uniform3i(location, value[0], value[1], value[2])',\n    ivec4:    'uniform4i(location, value[0], value[1], value[2], value[3])',\n\n    bool:     'uniform1i(location, value)',\n    bvec2:    'uniform2i(location, value[0], value[1])',\n    bvec3:    'uniform3i(location, value[0], value[1], value[2])',\n    bvec4:    'uniform4i(location, value[0], value[1], value[2], value[3])',\n\n    mat2:     'uniformMatrix2fv(location, false, value)',\n    mat3:     'uniformMatrix3fv(location, false, value)',\n    mat4:     'uniformMatrix4fv(location, false, value)',\n\n    sampler2D: 'uniform1i(location, value)',\n    samplerCube: 'uniform1i(location, value)',\n\n};\n\nconst GLSL_TO_ARRAY_SETTERS = {\n\n    float:    'uniform1fv(location, value)',\n\n    vec2:     'uniform2fv(location, value)',\n    vec3:     'uniform3fv(location, value)',\n    vec4:     'uniform4fv(location, value)',\n\n    int:      'uniform1iv(location, value)',\n    ivec2:    'uniform2iv(location, value)',\n    ivec3:    'uniform3iv(location, value)',\n    ivec4:    'uniform4iv(location, value)',\n\n    bool:     'uniform1iv(location, value)',\n    bvec2:    'uniform2iv(location, value)',\n    bvec3:    'uniform3iv(location, value)',\n    bvec4:    'uniform4iv(location, value)',\n\n    sampler2D: 'uniform1iv(location, value)',\n    samplerCube: 'uniform1i(location, value)',\n};\n\n/**\n * Extracts the attributes\n * @class\n * @memberof PIXI.glCore.shader\n * @param gl {WebGLRenderingContext} The current WebGL rendering context\n * @param uniforms {Array} @mat ?\n * @return attributes {Object}\n */\nexport default function generateUniformAccessObject(gl, uniformData)\n{\n    // this is the object we will be sending back.\n    // an object hierachy will be created for structs\n    const uniforms = { data: {} };\n\n    uniforms.gl = gl;\n\n    const uniformKeys = Object.keys(uniformData);\n\n    for (let i = 0; i < uniformKeys.length; i++)\n    {\n        const fullName = uniformKeys[i];\n\n        const nameTokens = fullName.split('.');\n        const name = nameTokens[nameTokens.length - 1];\n\n        const uniformGroup = getUniformGroup(nameTokens, uniforms);\n\n        const uniform =  uniformData[fullName];\n\n        uniformGroup.data[name] = uniform;\n\n        uniformGroup.gl = gl;\n\n        Object.defineProperty(uniformGroup, name, {\n            get: generateGetter(name),\n            set: generateSetter(name, uniform),\n        });\n    }\n\n    return uniforms;\n}\n\nfunction generateGetter(name)\n{\n    const template = getterTemplate.replace('%%', name);\n\n    return new Function(template); // eslint-disable-line no-new-func\n}\n\nfunction generateSetter(name, uniform)\n{\n    let template = setterTemplate.replace(/%%/g, name);\n    let setTemplate;\n\n    if (uniform.size === 1)\n    {\n        setTemplate = GLSL_TO_SINGLE_SETTERS[uniform.type];\n    }\n    else\n    {\n        setTemplate = GLSL_TO_ARRAY_SETTERS[uniform.type];\n    }\n\n    if (setTemplate)\n    {\n        template += `\\nthis.gl.${setTemplate};`;\n    }\n\n    return new Function('value', template); // eslint-disable-line no-new-func\n}\n\nfunction getUniformGroup(nameTokens, uniform)\n{\n    let cur = uniform;\n\n    for (let i = 0; i < nameTokens.length - 1; i++)\n    {\n        const o = cur[nameTokens[i]] || { data: {} };\n\n        cur[nameTokens[i]] = o;\n        cur = o;\n    }\n\n    return cur;\n}\n"]}